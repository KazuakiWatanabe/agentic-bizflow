# AGENTS.md  
Agentic BizFlow  
AIエージェント実装・レビュー・Git運用 共通ルール（日本語版）

本ドキュメントは、本リポジトリに関与する  
**すべてのAIエージェント（Codex 等）および人間レビューア**が  
**必ず遵守すべき最上位ルール**を定義します。

---

## 1. 本プロジェクトの目的（最重要）

本プロジェクトの目的は、  
**「業務文章を、実行可能な業務定義へ変換する Agentic AI を実装・提示すること」**です。

本リポジトリは以下を実証するためのものです。

- 単発のLLM呼び出しではなく **Agentic AI**
- 思考の分解・検証・再試行があること
- AIの判断過程が **可視化・検証可能**であること

### ❌ 許容されない実装
- 1回のプロンプトでJSONを生成するだけの処理
- チャットボット / FAQ 型アプリ
- 検証や失敗の存在しない出力

---

## 2. このリポジトリにおける「Agentic AI」の定義

以下 **すべてを満たす場合のみ**、Agentic AI とみなします。

1. 明確に役割分担された **複数の Agent** が存在する
2. 中央制御を行う **Orchestrator** が存在する
3. **Validator Agent** がパイプラインを失敗させる権限を持つ
4. 検証結果に基づく **Retry（再試行）ループ**がある
5. 出力は **スキーマによって決定論的に検証**される

1つでも欠けている実装は不適合です。

---

## 3. 各 Agent の責務（固定）

### ReaderAgent（理解）

**役割**
- 業務文章を読み取り、意味構造を抽出する

**抽出対象**
- 登場人物（roles / actors）
- 操作・行動（actions）
# AGENTS.md
Agentic BizFlow
AIエージェント実装・レビュー・Git運用 共通ルール（日本語版）

本ドキュメントは、本リポジトリに関与する
**すべてのAIエージェント（Codex 等）および人間レビューア**
**必ず遵守すべき最上位ルール**を定義します。

---

## 1. 本プロジェクトの目的（最重要）

本プロジェクトの目的は、
**「業務文章を、実行可能な業務定義へ変換する Agentic AI を実装・提示すること」**です。

本リポジトリは以下を実証するためのものです。

- 単発のLLM呼び出しではなく **Agentic AI**
- 思考の分解・検証・再試行があること
- AIの判断過程が **可視化・検証可能**であること

### ❌ 許容されない実装
- 1回のプロンプトでJSONを生成するだけの処理
- チャットボット / FAQ 型アプリ
- 検証や失敗の存在しない出力

---

## 2. このリポジトリにおける「Agentic AI」の定義

以下 **すべてを満たす場合のみ**、Agentic AI とみなします。

1. 明確に役割分担された **複数の Agent** が存在する
2. 中央制御を行う **Orchestrator** が存在する
3. **Validator Agent** がパイプラインを失敗させる権限を持つ
4. 検証結果に基づく **Retry（再試行）ループ**がある
5. 出力は **スキーマによって決定論的に検証**される

1つでも欠けている実装は不適合です。

---

## 3. 各 Agent の責務（固定）

### ReaderAgent（理解）

**役割**
- 業務文章を読み取り、意味構造を抽出する

**抽出対象**
- 登場人物（roles / actors）
- 操作・行動（actions）
- 条件（conditions）
- 例外・前提（exceptions / assumptions）

**禁止事項**
- 最終JSONを生成しない
- 不明点を黙って補完しない

---

### PlannerAgent（分解）

**役割**
- 業務を「実行可能な単位」に分解する

**出力内容**
- タスク候補
- 担当ロール
- 実行トリガー
- タスクの粒度整理

**禁止事項**
- 曖昧なタスクのまま通過させる
- 複数業務を1タスクにまとめる

---

### ValidatorAgent（検証・門番）

**役割**
- 以下を検出し、失敗判定を行う
  - 必須項目の欠落
  - 主語・条件の曖昧さ
  - 前提や判断基準の矛盾

**出力**
- `issues`: 問題点一覧
- `open_questions`: 未解決事項

**ルール**
- `issues` が1つでもあれば **必ず失敗**
- 自動修正・暗黙補完は禁止

---

### GeneratorAgent（生成）

**役割**
- 検証済み情報のみを使い、業務定義を生成する

**ルール**
- 出力は **Pydanticスキーマに完全準拠**
- 余計なフィールドは禁止
- 自然文はスキーマ外に出さない

---

## 4. Orchestrator のルール

### 実行順序（固定）
1. ReaderAgent
2. PlannerAgent
3. ValidatorAgent
4. GeneratorAgent

### 制御ルール
- 最大リトライ回数を設定（デフォルト：2回）
- Validator失敗時は **issues をプロンプトへ明示的に反映**
- 各ステップの要約ログを記録する

### 禁止事項
- 無限ループ
- 検証を飛ばす処理
- 失敗理由を隠した再試行

---

## 5. 出力インターフェース（厳守）

成功時レスポンス形式：

```json
{
  "definition": { /* BusinessDefinition */ },
  "agent_logs": [ /* 各Agentの要約ログ */ ],
  "meta": {
    "retries": 0,
    "model": "..."
  }
}
```

失敗時
HTTP 422 相当

バリデーション失敗理由の要約のみ返す

生のLLM出力は禁止

## 6. コーディング規約（PEP8 必須）

PEP8 準拠を必須

インデント：スペース4つ

最大行長：88文字

変数・関数：snake_case

クラス名：PascalCase

ワイルドカード import 禁止

black / isort 互換

## 7. ログ出力ルール

`agent_logs` は短い要約のみ

プロンプト全文や生レスポンスは禁止

個人情報・秘密情報を含めない

## 8. 依存関係・構成制限
依存ライブラリは最小限

DB・キューは使用しない（明示的指示がない限り）

ステートレス設計

Cloud Run 実行前提

## 9. Git ブランチ戦略（必須ルール）

本リポジトリでは、以下のブランチ戦略を公式ルールとします。

基本方針
- `main` は常に提出可能・デモ可能な状態を保つ

直接コミットは禁止

すべて短命ブランチからマージする

ブランチ構成（例）
```
main
 ├─ docs/architecture
 ├─ agentic-core
 ├─ backend-mvp
 ├─ frontend-mvp
 └─ polish-for-submission
```

各ブランチの役割
- `main`：公開・審査・提出対象ブランチ。README / AGENTS.md / デモが常に成立している状態。
- `docs/architecture`：設計・思想・仕様を固める（AGENTS.md / architecture.md / スキーマ定義）。コードを書かない。
- `agentic-core`：Agent / Orchestrator / Retry の中核実装（API / UI は扱わない）。
- `backend-mvp`：FastAPI / Cloud Run で動く最小API（`/api/convert` の完成、Dockerfile 含む）。
- `frontend-mvp`：デモ用UI（1画面）。入力 → JSON + agent_logs 表示。
- `polish-for-submission`：提出前の最終調整（README / 文言 / デモ用例文）。ロジックは変更しない。

運用ルール
- 各ブランチは目的完了後、速やかに `main` にマージ
- 提出用タグは必ず `main` から作成

## 10. レビュー用チェックリスト

- 各Agentが分離されている
- Validatorが失敗を返せる
- Retryループが機能している
- 出力が常にスキーマ準拠
- PEP8を満たしている
- `main`が常にデモ可能
- secretsが含まれていない

## 11. 思想（Why this exists）

このリポジトリは「AIに実装させること」そのものが目的ではありません。

曖昧な業務を構造化する

AIの思考を外に出す

人がレビュー可能な形にする

それが Agentic AI の価値です。

この思想に反する実装は、完成していても却下してください。